[general]
static=yes
writeprotect=no

[from-internal]
; Default context for WebRTC agents and incoming calls

; Hotline - Emergency number (117) WITH RECORDING
exten => 117,1,NoOp(Emergency Hotline Call from ${CALLERID(num)})
  same => n,Answer()
  same => n,Wait(0.5)
  ; Start recording BEFORE entering Stasis application
  same => n,Set(MIXMONITOR_FILENAME=/var/spool/asterisk/monitor/call-${UNIQUEID}.wav)
  same => n,MixMonitor(${MIXMONITOR_FILENAME},b)
  ; Enter Stasis application for ARI control
  same => n,Stasis(callcenter,117)
  ; After call ends, stop recording
  same => n,StopMixMonitor()
  same => n,Hangup()

; Echo test for WebRTC audio testing
exten => 999,1,NoOp(Echo Test for ${CALLERID(num)})
  same => n,Answer()
  same => n,Wait(0.5)
  same => n,Playback(demo-echotest)
  same => n,Echo()
  same => n,Hangup()

; Voicemail access
exten => *97,1,NoOp(Voicemail Access)
  same => n,VoiceMailMain()
  same => n,Hangup()

; Agent to agent calls
exten => _1XXX,1,NoOp(Agent to Agent: ${EXTEN})
  same => n,Dial(PJSIP/${EXTEN},30)
  same => n,Hangup()

[default]
; Fallback context for unmatched calls
exten => _X.,1,NoOp(Unhandled Call)
  same => n,Goto(from-internal,117,1)

; Agent extensions (1001-1099)
exten => _10XX,1,NoOp(Agent Extension ${EXTEN})
 same => n,Stasis(callcenter,agent-${EXTEN})
 same => n,Hangup()
